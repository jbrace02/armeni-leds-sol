"use strict";(()=>{var e={};e.id=170,e.ids=[170],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},9648:e=>{e.exports=import("axios")},2079:e=>{e.exports=import("openai")},6249:(e,r)=>{Object.defineProperty(r,"l",{enumerable:!0,get:function(){return function e(r,o){return o in r?r[o]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,o)):"function"==typeof r&&"default"===o?r:void 0}}})},8653:(e,r,o)=>{o.a(e,async(e,t)=>{try{o.r(r),o.d(r,{config:()=>d,default:()=>l,routeModule:()=>p});var i=o(1802),n=o(7153),a=o(6249),s=o(895),c=e([s]);s=(c.then?(await c)():c)[0];let l=(0,a.l)(s,"default"),d=(0,a.l)(s,"config"),p=new i.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/chat",pathname:"/api/chat",bundlePath:"",filename:""},userland:s});t()}catch(e){t(e)}})},895:(e,r,o)=>{o.a(e,async(e,t)=>{try{o.r(r),o.d(r,{default:()=>c});var i=o(2079),n=o(3655),a=o(326),s=e([i,a]);[i,a]=s.then?(await s)():s,new i.default({apiKey:process.env.OPENAI_API_KEY});let p=["iphone 15 pro max","iphone 15 pro","iphone 15","iphone 14 pro max","iphone 14 pro","iphone 14","iphone 13 pro max","iphone 13 pro","iphone 13","iphone 12 pro max","iphone 12 pro","iphone 12"].sort((e,r)=>r.length-e.length),u=["unlocked","at&t","verizon","t-mobile","sprint"],h=["64gb","128gb","256gb","512gb","1tb"];async function c(e,r){if("POST"!==e.method)return r.setHeader("Allow",["POST"]),r.status(405).end(`Method ${e.method} Not Allowed`);try{var o;let t;let{message:i,threadId:a,conversationHistory:s}=e.body,c=function(e){if(!e||0===e.length)return"greeting";let r=e.filter(e=>"assistant"===e.role).slice(-1)[0]?.content.toLowerCase()||"";if(r.includes("could you please tell me the model of your iphone"))return"model";if(r.includes("is your iphone unlocked or locked to a specific carrier"))return"carrier";if(r.includes("what's the storage capacity of your"))return"storage";if(r.includes("now, what's the condition of your device"))return"condition";if(r.includes("would you like to proceed with this offer"))return"quote";if(r.includes("what's your full name"))return"address_name";if(r.includes("what's your street address"))return"address_street";else if(r.includes("what city are you in"))return"address_city";else if(r.includes("which state"))return"address_state";else if(r.includes("what's your zip code"))return"address_zip";else if(r.includes("what's your phone number"))return"address_phone";else if(r.includes("what's your email for shipping updates"))return"address_email";else if(r.includes("here's your shipping label"))return"shipping_label";else if(r.includes("no problem"))return"end_conversation";else return"greeting"}(s),d=(o=[...s||[],{role:"user",content:i}],t={model:"",storage:"",carrier:"",condition:""},o.forEach(e=>{if("user"===e.role){let r=e.content.toLowerCase(),o=p.find(e=>r.includes(e));o&&(t.model=o);let i=r.match(/(\d+)\s*gb/i);for(let e of(i&&(t.storage=i[1]+"GB"),u))if(r.includes(e)){t.carrier=e.charAt(0).toUpperCase()+e.slice(1);break}/\b(a\/b|a|b)\b/i.test(r)?t.condition="A/B":/\bc\b/i.test(r)?t.condition="C":/\bd\b/i.test(r)&&(t.condition="D")}}),t),g="";if("greeting"===c)g="Hello! I can help you get a quote for your used iPhone. Could you please tell me the model of your iPhone?";else if("model"===c){let e=p.find(e=>i.toLowerCase().includes(e));e?(d.model=e,g=`Great, you have an ${e}. Is your iPhone unlocked or locked to a specific carrier? (Unlocked, AT&T, Verizon, T-Mobile, or Sprint)`):g="Sorry, I did not recognize that model. Please specify the exact model of your iPhone (e.g., iPhone 15 Pro Max)."}else if("carrier"===c){let e=u.find(e=>i.toLowerCase().includes(e));e?(d.carrier=e.charAt(0).toUpperCase()+e.slice(1),g=`Perfect! What's the storage capacity of your ${d.model}? (64GB, 128GB, 256GB, 512GB, or 1TB)`):g="Please specify your carrier (Unlocked, AT&T, Verizon, T-Mobile, or Sprint)."}else if("storage"===c){let e=i.toLowerCase().replace(/\s+/g,""),r=h.find(r=>e.includes(r));r?(d.storage=r.toUpperCase(),g=`Thanks! Now, what's the condition of your device? Please choose one of the following options:

1. **A/B**: Used condition, fully functional, no aftermarket parts (replaced by Apple is okay).
2. **C**: Cracked screen, but good LCD. No aftermarket parts. A bad button is okay.
3. **D**: Bad LCD (spots, bad touch), aftermarket LCDs, etc.`):g="Please specify a valid storage capacity (64GB, 128GB, 256GB, 512GB, or 1TB)."}else if("condition"===c){let e=i.toUpperCase().trim();if(["A/B","A","B","C","D"].includes(e)){let r=["A","B"].includes(e)?"A/B":e;d.condition=r;let o=(0,n.h)(d.model,d.storage,d.carrier,r);g=null!==o?`Based on your device details, we can offer you $${o} for your ${d.model} (${d.storage}, ${d.carrier}, ${r} condition).

Would you like to proceed with this offer?`:"I couldn't generate a quote for your device. Could we start over to verify the details?"}else g="Please specify a valid condition: A/B, C, or D."}else if("quote"===c){let e=i.trim().toLowerCase();g=/yes|proceed|ok|sure/i.test(e)?"Great! To generate your shipping label, I'll need your shipping information. What's your full name?":"No problem! Let me know if you have any other questions."}else if(c.startsWith("address_")){let e=await l(c,i,s,d);g=e.message,e.nextStep}else g="end_conversation"===c?"Thank you for considering our service. Feel free to reach out if you have more questions.":"Hello! I can help you get a quote for your used iPhone. Could you please tell me the model of your iPhone?";let m=[...s||[],{role:"user",content:i},{role:"assistant",content:g}];return r.status(200).json({response:g,threadId:a||null,conversationHistory:m})}catch(e){return console.error("Error processing request:",e),r.status(500).json({error:function(e){switch(e){case"price":return"I couldn't generate a quote for your device. Could we start over?";case"shipping":return"There was an error generating your shipping label. Please try again.";default:return"Something went wrong. Could you please try again?"}}("general")})}}async function l(e,r,o,t){let i=["address_name","address_street","address_city","address_state","address_zip","address_phone","address_email"],n=i.indexOf(e),s=n<i.length-1?i[n+1]:"shipping_label",c=function(e,r){switch(e){case"address_zip":return{isValid:/^\d{5}(-\d{4})?$/.test(r),message:"Please provide a valid ZIP code (e.g., 12345)."};case"address_phone":return{isValid:/^\(?([0-9]{3})\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4})$/.test(r),message:"Please provide a valid phone number (e.g., 123-456-7890)."};case"address_email":return{isValid:d(r),message:"Please provide a valid email address."};default:return{isValid:!!r.trim(),message:"This field cannot be empty."}}}(e,r);if(!c.isValid)return{message:c.message,nextStep:e};if("address_email"===e)try{let i=function(e,r,o){let t={name:"",street1:"",city:"",state:"",zip:"",email:"",phone:""};switch(e.forEach((r,o)=>{if("user"===r.role){let i=e[o-1];i?.role==="assistant"&&(i.content.includes("full name")?t.name=r.content:i.content.includes("street address")?t.street1=r.content:i.content.includes("city")?t.city=r.content:i.content.includes("state")?t.state=r.content:i.content.includes("ZIP code")?t.zip=r.content:i.content.includes("phone number")?t.phone=r.content:i.content.includes("email")&&(t.email=r.content))}}),o){case"address_name":t.name=r;break;case"address_street":t.street1=r;break;case"address_city":t.city=r;break;case"address_state":t.state=r;break;case"address_zip":t.zip=r;break;case"address_phone":t.phone=r;break;case"address_email":t.email=r}return t}(o,r,e);if(!d(r))return{message:"Please provide a valid email address.",nextStep:e};let n=await (0,a.b)(i,t);return{message:`Here's your shipping label: ${n.labelUrl}

Instructions:
1. Print the label
2. Attach it to a USPS Small Flat Rate Box
3. Drop off at any USPS location

Need a box? Get one free at your local post office or visit https://store.usps.com/

We've sent confirmation to ${i.email}. Let us know once you've shipped the device.`,nextStep:"shipping_label"}}catch(r){return console.error("Error generating shipping label:",r),{message:"There was an error generating your shipping label. Please try again.",nextStep:e}}return{message:function(e,r){switch(e){case"address_name":return"What's your full name?";case"address_street":return"What's your street address?";case"address_city":return"What city are you in?";case"address_state":return"Which state?";case"address_zip":return"What's your ZIP code?";case"address_phone":return"What's your phone number?";case"address_email":return"What's your email for shipping updates?";case"shipping_label":return"Processing your shipping label...";case"end_conversation":return"No problem! Let us know if you change your mind.";default:return"Could you please try that again?"}}(s,0),nextStep:s}}function d(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}t()}catch(e){t(e)}})},3655:(e,r,o)=>{o.d(r,{h:()=>n});let t=[{model:"iphone 15 pro max",storage:"256gb",carrier:"unlocked",condition:"A/B",price:750},{model:"iphone 15 pro max",storage:"256gb",carrier:"unlocked",condition:"C",price:450},{model:"iphone 15 pro max",storage:"256gb",carrier:"unlocked",condition:"D",price:200},{model:"iphone 15 pro max",storage:"256gb",carrier:"locked",condition:"A/B",price:575},{model:"iphone 15 pro max",storage:"256gb",carrier:"locked",condition:"C",price:345},{model:"iphone 15 pro max",storage:"256gb",carrier:"locked",condition:"D",price:115},{model:"iphone 15 pro max",storage:"512gb",carrier:"unlocked",condition:"A/B",price:815},{model:"iphone 15 pro max",storage:"512gb",carrier:"unlocked",condition:"C",price:505},{model:"iphone 15 pro max",storage:"512gb",carrier:"unlocked",condition:"D",price:205},{model:"iphone 15 pro max",storage:"512gb",carrier:"locked",condition:"A/B",price:660},{model:"iphone 15 pro max",storage:"512gb",carrier:"locked",condition:"C",price:400},{model:"iphone 15 pro max",storage:"512gb",carrier:"locked",condition:"D",price:120},{model:"iphone 15 pro max",storage:"1tb",carrier:"unlocked",condition:"A/B",price:865},{model:"iphone 15 pro max",storage:"1tb",carrier:"unlocked",condition:"C",price:555},{model:"iphone 15 pro max",storage:"1tb",carrier:"unlocked",condition:"D",price:205},{model:"iphone 15 pro max",storage:"1tb",carrier:"locked",condition:"A/B",price:710},{model:"iphone 15 pro max",storage:"1tb",carrier:"locked",condition:"C",price:450},{model:"iphone 15 pro max",storage:"1tb",carrier:"locked",condition:"D",price:120},{model:"iphone 15 pro",storage:"128gb",carrier:"unlocked",condition:"A/B",price:595},{model:"iphone 15 pro",storage:"128gb",carrier:"unlocked",condition:"C",price:295},{model:"iphone 15 pro",storage:"128gb",carrier:"unlocked",condition:"D",price:165},{model:"iphone 15 pro",storage:"128gb",carrier:"locked",condition:"A/B",price:445},{model:"iphone 15 pro",storage:"128gb",carrier:"locked",condition:"C",price:250},{model:"iphone 15 pro",storage:"128gb",carrier:"locked",condition:"D",price:90},{model:"iphone 15 pro",storage:"256gb",carrier:"unlocked",condition:"A/B",price:650},{model:"iphone 15 pro",storage:"256gb",carrier:"unlocked",condition:"C",price:350},{model:"iphone 15 pro",storage:"256gb",carrier:"unlocked",condition:"D",price:170},{model:"iphone 15 pro",storage:"256gb",carrier:"locked",condition:"A/B",price:500},{model:"iphone 15 pro",storage:"256gb",carrier:"locked",condition:"C",price:250},{model:"iphone 15 pro",storage:"256gb",carrier:"locked",condition:"D",price:95}],i=e=>e.toLowerCase().replace(/\s+/g,"").trim(),n=(e,r,o,n)=>{let a=i(e),s=i(r),c=i(o),l=n.toUpperCase().trim();console.log("Searching for:",{model:a,storage:s,carrier:c,condition:l});let d=t.find(e=>i(e.model)===a&&i(e.storage)===s&&i(e.carrier)===c&&e.condition.toUpperCase().trim()===l);return d?(console.log("Found entry:",d),d.price):(console.error("No matching pricing entry found."),null)}},326:(e,r,o)=>{o.a(e,async(e,t)=>{try{o.d(r,{b:()=>a});var i=o(9648),n=e([i]);async function a(e,r){let o=process.env.SHIPPO_API_KEY||"";try{let t={...e,country:"US"},n=(await i.default.post("https://api.goshippo.com/shipments/",{address_from:t,address_to:{name:"ShopRefit, LLC",street1:"10945 STATE BRIDGE RD STE 401",city:"ALPHARETTA",state:"GA",zip:"30022",country:"US",email:"jeremy@shoprefit.com",phone:"404-000-0000"},parcels:[{length:"8.7",width:"5.4",height:"1.7",distance_unit:"in",weight:"1",mass_unit:"lb"}],async:!1,extra:{reference_1:r.model||"",reference_2:`${r.storage||""} ${r.carrier||""}`,reference_3:`Condition: ${r.condition||""} Price: $${r.price||"0"}`}},{headers:{Authorization:`ShippoToken ${o}`,"Content-Type":"application/json"}})).data.rates;if(!n?.length)throw Error("No shipping rates available");let a=n.find(e=>"USPS"===e.provider&&"Priority Mail"===e.servicelevel.name);if(!a)throw Error("No USPS Priority Mail rate available");let s=(await i.default.post("https://api.goshippo.com/transactions/",{rate:a.object_id,label_file_type:"PDF",async:!1},{headers:{Authorization:`ShippoToken ${o}`,"Content-Type":"application/json"}})).data;if("SUCCESS"===s.status)return{labelUrl:s.label_url,trackingNumber:s.tracking_number};throw Error("Error purchasing label")}catch(e){throw console.error("Error generating shipping label:",e.response?.data||e.message),e}}i=(n.then?(await n)():n)[0],t()}catch(e){t(e)}})},7153:(e,r)=>{var o;Object.defineProperty(r,"x",{enumerable:!0,get:function(){return o}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(o||(o={}))},1802:(e,r,o)=>{e.exports=o(145)}};var r=require("../../webpack-api-runtime.js");r.C(e);var o=r(r.s=8653);module.exports=o})();